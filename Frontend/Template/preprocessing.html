<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Preprocessing - ClickTrain</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #f1f5f9;
      color: #1e293b;
      font-size: 14px
    }

    /* Nav */
    .nav-btn {
      display: flex;
      align-items: center;
      gap: 9px;
      width: 100%;
      padding: 9px 12px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #64748b;
      border-radius: 8px;
      text-align: left;
      transition: background .1s, color .1s
    }

    .nav-btn:hover {
      background: #f1f5f9;
      color: #1e293b
    }

    .nav-btn.active {
      background: #6366f1;
      color: #fff;
      font-weight: 600
    }

    .nav-num {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: #e2e8f0;
      color: #64748b;
      transition: .15s
    }

    .nav-btn.active .nav-num {
      background: rgba(255, 255, 255, .25);
      color: #fff
    }

    .nav-btn.done .nav-num {
      background: #22c55e;
      color: #fff
    }

    /* Layout */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #fff;
      border-bottom: 1px solid #e2e8f0;
      box-shadow: 0 1px 4px rgba(0, 0, 0, .06)
    }

    .layout {
      max-width: 1280px;
      margin: 0 auto;
      display: flex
    }

    .sidebar {
      width: 200px;
      flex-shrink: 0;
      background: #fff;
      border-right: 1px solid #e2e8f0;
      padding: 10px 8px;
      min-height: calc(100vh - 52px);
      overflow-y: auto
    }

    .content {
      flex: 1;
      padding: 16px;
      overflow-x: hidden;
      min-width: 0
    }

    /* Cards */
    .card {
      background: #fff;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, .04)
    }

    .card-h {
      font-size: 14px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 2px
    }

    .card-sub {
      font-size: 11px;
      color: #94a3b8;
      margin-bottom: 12px
    }

    /* ======= COLUMN PICKER (star feature) ======= */
    .cpicker {
      border: 1.5px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      background: #fff
    }

    .cpicker-bar {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 7px 8px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
      flex-wrap: wrap
    }

    .cpicker-search {
      flex: 1;
      min-width: 100px;
      padding: 5px 8px;
      border: 1.5px solid #e2e8f0;
      border-radius: 6px;
      font-size: 12px;
      outline: none;
      background: #fff;
      transition: border-color .15s
    }

    .cpicker-search:focus {
      border-color: #6366f1
    }

    .cpicker-btn {
      padding: 4px 8px;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      background: #fff;
      color: #64748b;
      transition: .1s;
      white-space: nowrap
    }

    .cpicker-btn:hover {
      background: #eef2ff;
      border-color: #a5b4fc;
      color: #4338ca
    }

    .cpicker-btn.xnum {
      border-color: #bbf7d0;
      background: #f0fdf4;
      color: #166534
    }

    .cpicker-btn.xnum:hover {
      background: #dcfce7
    }

    .cpicker-btn.xcat {
      border-color: #fde68a;
      background: #fefce8;
      color: #78350f
    }

    .cpicker-btn.xcat:hover {
      background: #fef9c3
    }

    .cpicker-list {
      max-height: 180px;
      overflow-y: auto;
      padding: 4px 0
    }

    .cpicker-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 10px;
      cursor: pointer;
      user-select: none;
      transition: background .08s
    }

    .cpicker-item:hover {
      background: #f8fafc
    }

    .cpicker-item.sel {
      background: #eef2ff
    }

    .cpicker-item input {
      display: none
    }

    .cpicker-check {
      width: 16px;
      height: 16px;
      border: 1.5px solid #cbd5e1;
      border-radius: 4px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: .1s;
      background: #fff
    }

    .cpicker-item.sel .cpicker-check {
      background: #6366f1;
      border-color: #6366f1
    }

    .cpicker-item.sel .cpicker-check::after {
      content: '';
      display: block;
      width: 4px;
      height: 7px;
      border: 2px solid #fff;
      border-top: none;
      border-left: none;
      transform: rotate(45deg) translate(-1px, -1px)
    }

    .cpicker-name {
      flex: 1;
      font-size: 12px;
      font-weight: 500;
      color: #374151;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap
    }

    .cpicker-type {
      font-size: 10px;
      font-weight: 700;
      padding: 1px 5px;
      border-radius: 3px;
      flex-shrink: 0
    }

    .type-num {
      background: #dcfce7;
      color: #166534
    }

    .type-cat {
      background: #fef9c3;
      color: #78350f
    }

    .cpicker-foot {
      padding: 5px 10px;
      background: #f8fafc;
      border-top: 1px solid #e2e8f0;
      font-size: 11px;
      color: #64748b;
      display: flex;
      align-items: center;
      justify-content: space-between
    }

    .cpicker-foot .auto-hint {
      color: #6366f1;
      font-weight: 600
    }

    .cpicker-hidden {
      display: none
    }

    /* Option cards */
    .opt-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px
    }

    .opt-c {
      padding: 8px 12px;
      border: 1.5px solid #e2e8f0;
      border-radius: 7px;
      cursor: pointer;
      transition: .1s;
      background: #fff;
      display: flex;
      flex-direction: column;
      min-width: 120px;
      flex: 1
    }

    .opt-c:hover {
      border-color: #a5b4fc;
      background: #fafafe
    }

    .opt-c.on {
      border-color: #6366f1;
      background: #eef2ff
    }

    .opt-c.on .oc-l {
      color: #4338ca
    }

    .opt-c.danger.on {
      border-color: #ef4444;
      background: #fff1f2
    }

    .opt-c.danger.on .oc-l {
      color: #dc2626
    }

    /* Toggle pills for binary choices */
    .tg-row {
      display: flex;
      border: 1.5px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 10px
    }

    .tg-opt {
      flex: 1;
      padding: 9px 14px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      text-align: center;
      color: #64748b;
      background: #fff;
      user-select: none;
      position: relative;
      border: none;
      transition: .12s
    }

    .tg-opt+.tg-opt::before {
      content: '';
      position: absolute;
      left: 0;
      top: 15%;
      height: 70%;
      width: 1px;
      background: #e2e8f0
    }

    .tg-opt input {
      display: none
    }

    .tg-opt.on {
      background: #6366f1;
      color: #fff;
      font-weight: 700
    }

    .tg-opt.on::before {
      display: none
    }

    .oc-l {
      font-size: 13px;
      font-weight: 600;
      color: #374151
    }

    .oc-h {
      font-size: 11px;
      color: #94a3b8;
      margin-top: 2px
    }

    .oc-inp {
      width: 80px;
      padding: 3px 6px;
      border: 1px solid #cbd5e1;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 4px;
      outline: none
    }

    .oc-inp:focus {
      border-color: #6366f1
    }

    /* Stats */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 8px;
      margin-bottom: 12px
    }

    .stat-b {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 7px;
      padding: 10px;
      text-align: center
    }

    .stat-v {
      font-size: 20px;
      font-weight: 700;
      color: #1e293b
    }

    .stat-l {
      font-size: 10px;
      color: #94a3b8;
      margin-top: 1px;
      text-transform: uppercase;
      letter-spacing: .04em;
      font-weight: 600
    }

    /* Table */
    .dt {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px
    }

    .dt th {
      background: #f8fafc;
      padding: 7px 10px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
      color: #64748b;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .04em
    }

    .dt td {
      padding: 7px 10px;
      border-bottom: 1px solid #f1f5f9;
      color: #374151
    }

    .dt tr:last-child td {
      border-bottom: none
    }

    /* Badges */
    .b {
      padding: 2px 7px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 700;
      display: inline-block
    }

    .bg {
      background: #dcfce7;
      color: #166534
    }

    .by {
      background: #fef9c3;
      color: #78350f
    }

    .br {
      background: #fee2e2;
      color: #991b1b
    }

    .bgr {
      background: #f1f5f9;
      color: #64748b
    }

    /* Buttons */
    .btn {
      padding: 9px 16px;
      border: none;
      border-radius: 7px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: .1s;
      width: 100%;
      margin-top: 8px
    }

    .btn:disabled {
      opacity: .4;
      cursor: not-allowed
    }

    .btn-i {
      background: #6366f1;
      color: #fff
    }

    .btn-i:hover:not(:disabled) {
      background: #4f46e5
    }

    .btn-g {
      background: #22c55e;
      color: #fff
    }

    .btn-g:hover:not(:disabled) {
      background: #16a34a
    }

    .btn-r {
      background: #ef4444;
      color: #fff
    }

    .btn-r:hover:not(:disabled) {
      background: #dc2626
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      background: #fff;
      color: #64748b;
      transition: .1s;
      width: auto
    }

    .btn-sm:hover {
      background: #f1f5f9
    }

    .info-link {
      font-size: 12px;
      color: #6366f1;
      font-weight: 600;
      border: 1.5px solid #c7d2fe;
      border-radius: 6px;
      padding: 3px 9px;
      cursor: pointer;
      background: #fff;
      white-space: nowrap
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 18px;
      right: 18px;
      z-index: 9999;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(6px);
      transition: .2s;
      pointer-events: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .15)
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0)
    }

    .tok {
      background: #22c55e;
      color: #fff
    }

    .terr {
      background: #ef4444;
      color: #fff
    }

    .tinf {
      background: #6366f1;
      color: #fff
    }

    /* Modal */
    .mbg {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, .4);
      z-index: 1000;
      align-items: center;
      justify-content: center
    }

    .mbg.show {
      display: flex
    }

    .mbox {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 440px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 50px rgba(0, 0, 0, .2)
    }

    /* Tabs */
    .tbar {
      display: flex;
      border-bottom: 2px solid #e2e8f0;
      margin-bottom: 12px;
      overflow-x: auto
    }

    .tab {
      padding: 7px 14px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      color: #64748b;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: .1s;
      white-space: nowrap
    }

    .tab.on {
      color: #6366f1;
      border-bottom-color: #6366f1;
      font-weight: 700
    }

    /* Hr */
    hr {
      border: none;
      border-top: 1px solid #e2e8f0;
      margin: 12px 0
    }

    /* Mobile */
    @media(max-width:660px) {
      .sidebar {
        position: fixed;
        left: -100%;
        top: 0;
        height: 100vh;
        z-index: 200;
        box-shadow: 4px 0 16px rgba(0, 0, 0, .1);
        transition: left .2s;
        width: 200px
      }

      .sidebar.open {
        left: 0
      }

      .content {
        padding: 10px
      }

      .stats-row {
        grid-template-columns: 1fr 1fr
      }

      .opt-row {
        flex-direction: column
      }
    }

    /* Row label */
    .rl {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .04em;
      color: #64748b;
      margin-bottom: 5px
    }

    /* Div+inp */
    .inp {
      width: 100%;
      padding: 7px 10px;
      border: 1.5px solid #e2e8f0;
      border-radius: 7px;
      font-size: 13px;
      outline: none;
      transition: .1s
    }

    .inp:focus {
      border-color: #6366f1
    }
  </style>
</head>

<body>
  <div id="ml-header"></div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Modal -->
  <div id="modal" class="mbg" onclick="if(event.target===this)closeModal()">
    <div class="mbox">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <span id="modalT" style="font-size:14px;font-weight:700"></span>
        <button onclick="closeModal()"
          style="font-size:20px;background:none;border:none;cursor:pointer;color:#94a3b8;line-height:1">&times;</button>
      </div>
      <div id="modalB" style="font-size:13px;line-height:1.7;color:#475569"></div>
    </div>
  </div>

  <!-- Overlay mobile -->
  <div id="ov" onclick="closeSB()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:150">
  </div>

  <!-- Top bar -->
  <div class="topbar">
    <div
      style="max-width:1280px;margin:0 auto;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:10px">
        <button id="menuBtn" onclick="toggleSB()" style="display:none" class="btn-sm">Menu</button>
        <div>
          <div style="font-size:14px;font-weight:700" id="dsN">Loading...</div>
          <div style="font-size:11px;color:#94a3b8" id="dsS">&nbsp;</div>
        </div>
      </div>
      <div style="display:flex;gap:6px">
        <button id="undoB" onclick="undoA()" disabled class="btn-sm">Undo</button>
        <button id="redoB" onclick="redoA()" disabled class="btn-sm">Redo</button>
        <button onclick="resetA()" class="btn-sm"
          style="border-color:#fca5a5;color:#dc2626;background:#fff1f2">Reset</button>
      </div>
    </div>
  </div>

  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div
        style="padding:0 4px 8px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:#94a3b8">
        Steps</div>
      <button class="nav-btn active" data-s="missing" onclick="go('missing')"><span class="nav-num"
          id="n1">1</span>Missing Values</button>
      <button class="nav-btn" data-s="duplicates" onclick="go('duplicates')"><span class="nav-num"
          id="n2">2</span>Duplicates</button>
      <button class="nav-btn" data-s="constant" onclick="go('constant')"><span class="nav-num" id="n3">3</span>Constant
        Cols</button>
      <button class="nav-btn" data-s="encoding" onclick="go('encoding')"><span class="nav-num"
          id="n4">4</span>Encoding</button>
      <button class="nav-btn" data-s="scaling" onclick="go('scaling')"><span class="nav-num"
          id="n5">5</span>Scaling</button>
      <button class="nav-btn" data-s="outliers" onclick="go('outliers')"><span class="nav-num"
          id="n6">6</span>Outliers</button>
      <button class="nav-btn" data-s="sampling" onclick="go('sampling')"><span class="nav-num"
          id="n7">7</span>Sampling</button>
      <button class="nav-btn" data-s="report" onclick="go('report')"><span class="nav-num" id="n8">8</span>Report +
        Export</button>
      <hr style="margin:10px 0;border-color:#e2e8f0">
      <div
        style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:#94a3b8;padding:0 4px;margin-bottom:6px">
        History</div>
      <div id="histL" style="font-size:11px;color:#64748b;max-height:280px;overflow-y:auto;padding:0 4px"></div>
    </aside>

    <!-- Main content -->
    <main class="content">

      <!-- 1. MISSING VALUES -->
      <div id="sec-missing" class="sec">
        <div class="card" style="padding:12px">
          <div class="stats-row">
            <div class="stat-b">
              <div class="stat-v" id="mv-t">-</div>
              <div class="stat-l">Missing</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="mv-p">-</div>
              <div class="stat-l">% of Data</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="mv-c">-</div>
              <div class="stat-l">Affected Cols</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="mv-r">-</div>
              <div class="stat-l">Total Rows</div>
            </div>
          </div>
        </div>
        <div class="card" style="padding:0;overflow:hidden">
          <div style="padding:10px 14px;display:flex;align-items:center;justify-content:space-between">
            <span style="font-size:13px;font-weight:700">Missing by Column</span>
            <button class="info-link" onclick="showInfo('missing')">What is this?</button>
          </div>
          <div style="overflow-x:auto">
            <table class="dt" id="mvT">
              <thead>
                <tr>
                  <th>Column</th>
                  <th>Type</th>
                  <th>Missing</th>
                  <th>%</th>
                  <th>Level</th>
                </tr>
              </thead>
              <tbody id="mvB"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:2px">
            <div class="card-h">Fix Numerical Columns</div>
            <span style="font-size:11px;color:#94a3b8">numbers only</span>
          </div>
          <div class="card-sub">Leave all unchecked to apply to every numerical column</div>
          <div id="pk-numMis" class="cpicker"></div>
          <hr>
          <div class="rl">Fill Method</div>
          <div class="opt-row" id="og-numMis">
            <label class="opt-c" onclick="optPick(this,'og-numMis')"><input type="radio" name="nMis" value="mean"><span
                class="oc-l">Mean</span><span class="oc-h">Column average</span></label>
            <label class="opt-c" onclick="optPick(this,'og-numMis')"><input type="radio" name="nMis"
                value="median"><span class="oc-l">Median</span><span class="oc-h">Safe for skewed data</span></label>
            <label class="opt-c" onclick="optPick(this,'og-numMis')"><input type="radio" name="nMis"
                value="constant_num"><span class="oc-l">Number: <input type="number" class="oc-inp" id="cNum" value="0"
                  onclick="event.stopPropagation()"></span><span class="oc-h">Custom fill value</span></label>
            <label class="opt-c danger" onclick="optPick(this,'og-numMis')"><input type="radio" name="nMis"
                value="drop"><span class="oc-l">Drop Rows</span><span class="oc-h">Removes rows
                permanently</span></label>
          </div>
          <button class="btn btn-i" id="applyNMBtn" onclick="applyNM()">Apply to Numerical Columns</button>
        </div>

        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:2px">
            <div class="card-h">Fix Categorical Columns</div>
            <span style="font-size:11px;color:#94a3b8">text / categories</span>
          </div>
          <div class="card-sub">Leave all unchecked to apply to every categorical column</div>
          <div id="pk-catMis" class="cpicker"></div>
          <hr>
          <div class="rl">Fill Method</div>
          <div class="opt-row" id="og-catMis">
            <label class="opt-c" onclick="optPick(this,'og-catMis')"><input type="radio" name="cMis" value="mode"><span
                class="oc-l">Mode</span><span class="oc-h">Most common value</span></label>
            <label class="opt-c" onclick="optPick(this,'og-catMis')"><input type="radio" name="cMis"
                value="constant_cat"><span class="oc-l">Custom: <input type="text" class="oc-inp" id="cCat"
                  value="Unknown" onclick="event.stopPropagation()"></span><span class="oc-h">Your chosen
                text</span></label>
            <label class="opt-c danger" onclick="optPick(this,'og-catMis')"><input type="radio" name="cMis"
                value="drop"><span class="oc-l">Drop Rows</span><span class="oc-h">Removes rows
                permanently</span></label>
          </div>
          <button class="btn" id="applyCMBtn" style="background:#f59e0b;color:#fff;margin-top:8px"
            onclick="applyCM()">Apply to
            Categorical Columns</button>
        </div>
      </div>

      <!-- 2. DUPLICATES -->
      <div id="sec-duplicates" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <div class="card-h">Duplicate Rows</div>
            <button class="info-link" onclick="showInfo('duplicates')">What is this?</button>
          </div>
          <div class="stats-row">
            <div class="stat-b">
              <div class="stat-v" id="d-c">-</div>
              <div class="stat-l">Duplicates</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="d-u">-</div>
              <div class="stat-l">Unique Rows</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="d-p">-</div>
              <div class="stat-l">% Duplicate</div>
            </div>
          </div>
          <div id="d-prev" style="overflow-x:auto;font-size:12px;margin-bottom:10px"></div>
          <hr>
          <div style="font-size:12px;color:#64748b;margin-bottom:6px">Which copy to keep when duplicates are found?
          </div>
          <div class="tg-row">
            <label class="tg-opt on" onclick="tgPick(this)"><input type="radio" name="dKeep" value="first" checked>Keep
              First Occurrence</label>
            <label class="tg-opt" onclick="tgPick(this)"><input type="radio" name="dKeep" value="last">Keep Last
              Occurrence</label>
          </div>
          <button class="btn btn-r" id="dupBtn" onclick="applyDup()">Remove Duplicate Rows</button>
        </div>
      </div>

      <!-- 3. CONSTANT COLUMNS -->
      <div id="sec-constant" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
            <div class="card-h">Constant Columns</div>
            <button class="info-link" onclick="showInfo('constant')">What is this?</button>
          </div>
          <div class="card-sub">Columns with the same value in every row â€” zero information, safe to remove.</div>
          <div id="constL"></div>
          <button class="btn btn-r" id="constBtn" onclick="applyConst()" disabled style="margin-top:10px">Remove
            Selected</button>
        </div>
      </div>

      <!-- 4. ENCODING -->
      <div id="sec-encoding" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <div class="card-h">Categorical Encoding</div>
            <button class="info-link" onclick="showInfo('encoding')">What is this?</button>
          </div>
          <div class="tbar">
            <button class="tab on" data-et="label" onclick="eTab('label')">Label</button>
            <button class="tab" data-et="onehot" onclick="eTab('onehot')">One-Hot</button>
            <button class="tab" data-et="ordinal" onclick="eTab('ordinal')">Ordinal</button>
            <button class="tab" data-et="target" onclick="eTab('target')">Target</button>
          </div>
          <div id="et-label" class="ep">
            <div class="card-sub" style="margin-bottom:8px">Converts each category to a number (0,1,2...). Leave all
              unchecked = apply to all.</div>
            <div id="pk-label" class="cpicker"></div>
            <button class="btn btn-i" id="applyLabelBtn" onclick="applyLabel()">Apply Label Encoding</button>
          </div>
          <div id="et-onehot" class="ep" style="display:none">
            <div class="card-sub" style="margin-bottom:8px">Creates one binary column per category. Leave all unchecked
              = apply to all.</div>
            <div id="pk-onehot" class="cpicker"></div>
            <label style="display:flex;align-items:center;gap:7px;font-size:13px;margin:8px 0;cursor:pointer"><input
                type="checkbox" id="ohDrop"> Drop first column (avoids multicollinearity)</label>
            <button class="btn btn-i" id="applyOHBtn" onclick="applyOnehot()">Apply One-Hot Encoding</button>
          </div>
          <div id="et-ordinal" class="ep" style="display:none">
            <div class="card-sub" style="margin-bottom:8px">Assign order-based numbers. Use when order matters (Low,
              Medium, High).</div>
            <div class="rl">Select Column</div>
            <select id="ordC" class="inp" style="margin-bottom:8px"></select>
            <label
              style="display:flex;align-items:center;gap:7px;font-size:13px;margin-bottom:6px;cursor:pointer"><input
                type="checkbox" id="ordA" checked onchange="toggleOrdM()"> Auto-detect order</label>
            <div id="ordM" style="display:none;margin-bottom:8px">
              <div class="rl">Order (comma-separated, lowest first)</div><input type="text" id="ordO" class="inp"
                placeholder="e.g. Low, Medium, High">
            </div>
            <button class="btn btn-i" id="applyOrdBtn" onclick="applyOrdinal()">Apply Ordinal Encoding</button>
          </div>
          <div id="et-target" class="ep" style="display:none">
            <div
              style="background:#fff7ed;border:1px solid #fed7aa;border-radius:7px;padding:8px 10px;margin-bottom:8px;font-size:12px;color:#92400e">
              Warning: Can cause data leakage. Use with proper cross-validation.</div>
            <div class="rl">Columns to Encode</div>
            <div id="pk-target" class="cpicker" style="margin-bottom:8px"></div>
            <div class="rl">Target Column</div>
            <select id="tgtC" class="inp" style="margin-bottom:8px">
              <option value="">Select...</option>
            </select>
            <button class="btn btn-i" id="applyTgtBtn" onclick="applyTarget()">Apply Target Encoding</button>
          </div>
        </div>
      </div>

      <!-- 5. SCALING -->
      <div id="sec-scaling" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
            <div class="card-h">Feature Scaling</div>
            <button class="info-link" onclick="showInfo('scaling')">What is this?</button>
          </div>
          <div class="card-sub">Puts all numbers on the same scale. Required for KNN, SVM, Neural Networks.</div>
          <div class="rl">Method</div>
          <div class="opt-row" id="og-scaler" style="margin-bottom:12px">
            <label class="opt-c on" onclick="optPick(this,'og-scaler')"><input type="radio" name="scM" value="standard"
                checked><span class="oc-l">Standard</span><span class="oc-h">Mean=0, Std=1</span></label>
            <label class="opt-c" onclick="optPick(this,'og-scaler')"><input type="radio" name="scM" value="minmax"><span
                class="oc-l">Min-Max</span><span class="oc-h">Scales to 0-1</span></label>
            <label class="opt-c" onclick="optPick(this,'og-scaler')"><input type="radio" name="scM" value="robust"><span
                class="oc-l">Robust</span><span class="oc-h">Best for outliers</span></label>
          </div>
          <div class="rl">Numerical Columns <span style="text-transform:none;font-weight:400;color:#94a3b8">(leave
              unchecked = apply to all)</span></div>
          <div id="pk-scale" class="cpicker"></div>
          <button class="btn btn-i" id="applyScaleBtn" onclick="applyScaling()">Apply Scaling</button>
        </div>
      </div>

      <!-- 6. OUTLIERS -->
      <div id="sec-outliers" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
            <div class="card-h">Outlier Handling</div>
            <button class="info-link" onclick="showInfo('outliers')">What is this?</button>
          </div>
          <div class="card-sub">Extreme values that distort model training. Only remove if they are actual errors.</div>
          <div class="rl" style="margin-bottom:5px">Detection Method</div>
          <div class="tg-row" style="margin-bottom:12px">
            <label class="tg-opt on" onclick="tgPick(this)"><input type="radio" name="oD" value="iqr" checked>IQR <span
                style="font-size:11px;opacity:.7">(most data)</span></label>
            <label class="tg-opt" onclick="tgPick(this)"><input type="radio" name="oD" value="zscore">Z-Score <span
                style="font-size:11px;opacity:.7">(normal dist.)</span></label>
          </div>
          <div class="rl">Numerical Columns <span style="text-transform:none;font-weight:400;color:#94a3b8">(leave
              unchecked = apply to all)</span></div>
          <div id="pk-out" class="cpicker" style="margin-bottom:12px"></div>
          <div class="rl">Action</div>
          <div class="opt-row" id="og-outAct">
            <label class="opt-c" onclick="optPick(this,'og-outAct')"><input type="radio" name="oA" value="remove"><span
                class="oc-l">Remove Rows</span><span class="oc-h">Dataset gets smaller</span></label>
            <label class="opt-c on" onclick="optPick(this,'og-outAct')"><input type="radio" name="oA" value="cap"
                checked><span class="oc-l">Cap Values</span><span class="oc-h">Clips, keeps all rows</span></label>
            <label class="opt-c" onclick="optPick(this,'og-outAct')"><input type="radio" name="oA" value="flag"><span
                class="oc-l">Flag Only</span><span class="oc-h">Adds a flag column</span></label>
          </div>
          <button class="btn btn-i" id="applyOutBtn" onclick="applyOut()">Apply Outlier Handling</button>
        </div>
      </div>

      <!-- 7. SAMPLING -->
      <div id="sec-sampling" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
            <div class="card-h">Class Balancing</div>
            <button class="info-link" onclick="showInfo('sampling')">What is this?</button>
          </div>
          <div class="card-sub">Balance unequal class counts in your target column.</div>
          <div class="rl">Target Column</div>
          <select id="sampT" class="inp" onchange="loadDist()" style="margin-bottom:10px">
            <option value="">Select target column...</option>
          </select>
          <div id="distB" style="display:none;margin-bottom:10px">
            <div id="distP" style="height:200px"></div>
            <p id="distM" style="font-size:12px;color:#64748b;margin-top:4px"></p>
          </div>
          <div class="rl">Method</div>
          <div class="opt-row" id="og-samp">
            <label class="opt-c on" onclick="optPick(this,'og-samp')"><input type="radio" name="sM" value="smote"
                checked><span class="oc-l">SMOTE</span><span class="oc-h">Creates synthetic samples</span></label>
            <label class="opt-c" onclick="optPick(this,'og-samp')"><input type="radio" name="sM" value="over"><span
                class="oc-l">Over-Sample</span><span class="oc-h">Duplicates minority rows</span></label>
            <label class="opt-c" onclick="optPick(this,'og-samp')"><input type="radio" name="sM" value="under"><span
                class="oc-l">Under-Sample</span><span class="oc-h">Removes majority rows</span></label>
          </div>
          <button class="btn btn-i" id="applySampBtn" onclick="applySamp()">Apply Sampling</button>
        </div>
      </div>

      <!-- 8. REPORT -->
      <div id="sec-report" class="sec" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div class="card-h">Preprocessing Report</div>
            <button class="btn-sm" onclick="loadReport()" style="border-color:#c7d2fe;color:#6366f1">Refresh</button>
          </div>
          <div class="stats-row">
            <div class="stat-b">
              <div class="stat-v" id="r-or">-</div>
              <div class="stat-l">Orig Rows</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="r-cr" style="color:#6366f1">-</div>
              <div class="stat-l">Now Rows</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="r-oc">-</div>
              <div class="stat-l">Orig Cols</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="r-cc" style="color:#6366f1">-</div>
              <div class="stat-l">Now Cols</div>
            </div>
            <div class="stat-b">
              <div class="stat-v" id="r-st" style="color:#22c55e">0</div>
              <div class="stat-l">Steps Done</div>
            </div>
          </div>
          <div class="rl">Steps Applied</div>
          <div id="rSteps" style="margin-bottom:12px">
            <p style="font-size:12px;color:#94a3b8;font-style:italic">No steps yet.</p>
          </div>
          <div class="rl">Data Quality</div>
          <div style="overflow-x:auto;margin-bottom:12px">
            <table class="dt">
              <thead>
                <tr>
                  <th>Check</th>
                  <th>Status</th>
                  <th>Detail</th>
                </tr>
              </thead>
              <tbody id="rQual"></tbody>
            </table>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <button class="btn btn-g" onclick="exportCSV()">Download CSV</button>
            <button class="btn btn-i" onclick="goTrain()">Go to Training</button>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script src="preprocessing_script.js"></script>
  <script src="header.js"></script>
</body>

</html>